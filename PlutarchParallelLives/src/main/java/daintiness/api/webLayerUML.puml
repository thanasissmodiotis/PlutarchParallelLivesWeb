@startuml WebLayerArchitecture

' ============================================================
' UML Class Diagram: Spring Boot Web Layer
' PlutarchParallelLives - daintiness.api package
' ============================================================

skinparam classAttributeIconSize 0
skinparam classFontStyle bold
skinparam packageStyle rectangle
skinparam linetype ortho

' Color scheme matching existing project diagrams
skinparam class {
    BackgroundColor White
    BorderColor Black
    ArrowColor Black
}

skinparam package {
    BackgroundColor #FAFAFA
    BorderColor #CCCCCC
}

' ============================================================
' Package: daintiness.api (NEW - Web Layer)
' ============================================================

package "daintiness.api" #E8F4FD {
    
    class DaintinessRestAPI <<@RestController>> {
        - projectStore : ProjectStore
        --
        + createProject() : ResponseEntity<Map>
        + deleteProject(projectId) : ResponseEntity<Void>
        + loadFile(projectId, file) : ResponseEntity<Map>
        + loadSchemaEvoFolder(projectId, ...) : ResponseEntity<Map>
        + importProject(projectId, tem, gpm) : ResponseEntity<Map>
        + exportProject(projectId) : ResponseEntity<Resource>
        + getProjectInfo(projectId) : ResponseEntity<Map>
        + clusterData(projectId, request) : ResponseEntity<Map>
        + getChartData(projectId) : ResponseEntity<Map>
        + generateChartData(projectId, request) : ResponseEntity<Map>
        + getMeasurementTypes(projectId) : ResponseEntity<Map>
        + sortChartData(projectId, sortType) : ResponseEntity<Map>
        + getPatterns(projectId, patternType) : ResponseEntity<List>
        + exportPatterns(projectId) : ResponseEntity<Resource>
        --
        - serializeChartData(chartData, phases) : List<Map>
        - serializePhases(phases) : List<Map>
        - serializeEntityGroups(groups) : List<Map>
        - serializePatterns(patterns) : List<Map>
        - getEntityGroupName(group) : String
        - getColorForGPMType(type) : String
    }
    
    class ProjectStore <<@Component>> {
        - projects : ConcurrentMap<String, IMainController>
        - factory : MainControllerFactory
        --
        + createProject() : String
        + get(projectId) : Optional<IMainController>
        + delete(projectId) : boolean
    }
    
    class ClusteringRequest <<DTO>> {
        - numberOfPhases : int
        - numberOfEntityGroups : int
        - changesWeight : double
        - timeClusteringEnabled : boolean
        - entityClusteringEnabled : boolean
        --
        + getters/setters
    }
    
    class ChartDataRequest <<DTO>> {
        - measurementType : String
        - aggregationType : String
        --
        + getters/setters
    }
    
}

' ============================================================
' Package: daintiness.maincontroller (Existing)
' ============================================================

package "daintiness.maincontroller" #F5F5F5 {
    
    interface IMainController {
        + load(inputFile : File)
        + save(outputFile : File)
        + save()
        + hasOutputPath() : boolean
        + sortChartData(type : SortingType)
        + getPhases() : List<Phase>
        + getEntityGroups() : List<EntityGroup>
        + getAvailableMeasurementTypesList() : List<MeasurementType>
        + getMeasurementType() : MeasurementType
        + getAvailableAggregationTypesList() : List<AggregationType>
        + getAggregationType() : AggregationType
        + getChartData() : ObservableList<ChartGroupPhaseMeasurement>
        + generateChartDataOfType(measurementType, aggregationType)
        + fitDataToGroupPhaseMeasurements(profile : ClusteringProfile)
        + getNumberOfBeats() : int
        + getNumberOfEntities() : int
        + getNumberOfTEMs() : int
        + exportProject(projectFolder : File)
        + importProject(projectFolder : File)
        + getPatterns(patternType) : List<PatternData>
        + printPatterns(outputFile : File)
    }
    
    class MainController implements IMainController {
        - fileHandler : IFileHandler
        - dataHandler : IDataHandler
        - clusteringHandler : IClusteringHandler
        - patternManager : IPatternManager
    }
    
    class MainControllerFactory {
        + getMainController(type : String) : IMainController
    }
    
}

' ============================================================
' Package: daintiness.clustering (Existing - Key Types)
' ============================================================

package "daintiness.clustering" #F5F5F5 {
    
    class ClusteringProfile {
        - beatProfile : BeatClusteringProfile
        - entityProfile : EntityClusteringProfile
    }
    
    class BeatClusteringProfile {
        - numberOfPhases : int
        - changesWeight : double
    }
    
    class EntityClusteringProfile {
        - numberOfEntityGroups : int
    }
    
    class Phase {
        - phaseId : int
        - phaseComponents : List<Beat>
    }
    
    class EntityGroup {
        - entityGroupId : int
        - groupComponents : List<Entity>
        - lifeDetails : LifeDetails
    }
    
}

' ============================================================
' Package: daintiness.models (Existing - Key Types)
' ============================================================

package "daintiness.models" #F5F5F5 {
    
    class PatternData {
        - patternType : PatternType
        - patternCellsList : List<CellInfo>
    }
    
}

' ============================================================
' Package: daintiness.utilities (Existing)
' ============================================================

package "daintiness.utilities" #F5F5F5 {
    
    enum "Constants.SortingType" as SortingType {
        ACTIVITY_ASCENDING
        ACTIVITY_DESCENDING
        BIRTH_ASCENDING
        BIRTH_DESCENDING
        LIFE_DURATION_ASCENDING
        LIFE_DURATION_DESCENDING
    }
    
    enum "Constants.MeasurementType" as MeasurementType {
        DELTA_VALUE
        RAW_VALUE
    }
    
    enum "Constants.AggregationType" as AggregationType {
        SUM_OF_INSERTIONS
        SUM_OF_DELETIONS
        ...
    }
    
    enum "Constants.PatternType" as PatternType {
        NO_TYPE
        MULTIPLE_BIRTHS
        MULTIPLE_UPDATES
        MULTIPLE_DEATHS
        LADDER
    }
    
}

' ============================================================
' Package: Spring Boot / External
' ============================================================

package "org.springframework" #EEEEEE {
    
    annotation RestController
    annotation Component
    annotation Autowired
    annotation RequestMapping
    annotation PostMapping
    annotation GetMapping
    annotation DeleteMapping
    
    class ResponseEntity<T>
    class MultipartFile
    
}

' ============================================================
' Relationships
' ============================================================

' DaintinessRestAPI dependencies
DaintinessRestAPI --> ProjectStore : <<@Autowired>>
DaintinessRestAPI ..> IMainController : uses
DaintinessRestAPI +-- ClusteringRequest : inner class
DaintinessRestAPI +-- ChartDataRequest : inner class
DaintinessRestAPI ..> ClusteringProfile : creates
DaintinessRestAPI ..> Phase : serializes
DaintinessRestAPI ..> EntityGroup : serializes
DaintinessRestAPI ..> PatternData : serializes

' ProjectStore dependencies
ProjectStore --> MainControllerFactory : uses
ProjectStore --> IMainController : stores *

' MainController implementation
MainController ..|> IMainController

' ClusteringProfile composition
ClusteringProfile o-- BeatClusteringProfile
ClusteringProfile o-- EntityClusteringProfile

' Request mappings use enums
DaintinessRestAPI ..> SortingType : uses
DaintinessRestAPI ..> MeasurementType : uses
DaintinessRestAPI ..> AggregationType : uses
DaintinessRestAPI ..> PatternType : uses

' ============================================================
' Notes
' ============================================================

note right of DaintinessRestAPI
    **REST API Controller**
    Base path: /api
    
    Endpoints:
    - POST   /projects
    - DELETE /projects/{id}
    - POST   /projects/{id}/load
    - POST   /projects/{id}/loadSchemaEvo
    - POST   /projects/{id}/importProject
    - POST   /projects/{id}/exportProject
    - GET    /projects/{id}/info
    - POST   /projects/{id}/cluster
    - GET    /projects/{id}/chartData
    - POST   /projects/{id}/chartData/generate
    - GET    /projects/{id}/measurementTypes
    - POST   /projects/{id}/sort
    - GET    /projects/{id}/patterns
    - POST   /projects/{id}/patterns/export
end note

note left of ProjectStore
    **Session Management**
    - ConcurrentHashMap for thread safety
    - UUID-based project IDs
    - In-memory storage (no persistence)
end note

note bottom of IMainController
    **Facade Pattern**
    Single entry point to all
    core business logic
end note

@enduml
